CREATE SCHEMA Livraria;

SET search_path TO Livraria;

CREATE TABLE AUTOR(
    COD_AUTOR SMALLINT NOT NULL ,
    NOME VARCHAR(20) NOT NULL,
    NASCIMENTO DATE NOT NULL,
    CONSTRAINT CHAVEAUTOR PRIMARY KEY (COD_AUTOR)
);

CREATE TABLE EDITORA(
    COD_EDITORA SMALLINT NOT NULL, 
    RAZAO VARCHAR(20),
    ENDERECO CHAR(20),
    CIDADE CHAR(70),
    CONSTRAINT CHAVEEDITORA PRIMARY KEY (COD_EDITORA)
);

CREATE TABLE LIVRO(
    COD_LIVRO SMALLINT NOT NULL,
    TITULO CHAR(35) NOT NULL,
    VALOR NUMERIC(7,2),
    VOLUME SMALLINT,
    COD_EDITORA SMALLINT NOT NULL,
    CONSTRAINT CHAVELIVRO PRIMARY KEY (COD_LIVRO),
    CONSTRAINT ESTRANGEIRAEDITORA FOREIGN KEY (COD_EDITORA)           
      REFERENCES EDITORA
);

CREATE TABLE ESCREVE(
    COD_LIVRO_ESC SMALLINT NOT NULL,
    COD_AUTOR_ESC SMALLINT NOT NULL,
    CONSTRAINT CHAVEESCREVE PRIMARY KEY (COD_LIVRO_ESC, COD_AUTOR_ESC),
    CONSTRAINT ESTRANGEIRALIVRO FOREIGN KEY (COD_LIVRO_ESC) REFERENCES LIVRO,
    CONSTRAINT ESTRANGEIRAAUTOR FOREIGN KEY (COD_AUTOR_ESC) REFERENCES AUTOR
);

CREATE TABLE AUTOREXPERIENTE(
   COD_AUTOR SMALLINT NOT NULL CONSTRAINT CHAVEAUTOREXP PRIMARY KEY,
   NOME VARCHAR(30) NOT NULL,
   NASCIMENTO DATE NOT NULL 
);

set datestyle to 'dmy';
INSERT INTO AUTOR VALUES (1, 'PAULO COELHO', '1/1/1947');
INSERT INTO AUTOR VALUES (2, 'MACHADO DE ASSIS', '21/06/1839');
INSERT INTO AUTOR VALUES (3, 'JOSÉ MARIA', '25/08/1960');

INSERT INTO EDITORA VALUES (1, 'ROCCO', 'R. RODRIGO SILVA, 26', 'RIO DE JANEIRO');
INSERT INTO EDITORA (COD_EDITORA, RAZAO, CIDADE) VALUES (2, 'GLOBO', 'RIO DE JANEIRO');
INSERT INTO EDITORA (COD_EDITORA, RAZAO, CIDADE) VALUES (3, 'ATICA', 'SÃO PAULO');
INSERT INTO EDITORA (COD_EDITORA, RAZAO) VALUES (4, 'USP/ICMC');

INSERT INTO LIVRO ( COD_LIVRO, TITULO, VALOR, COD_EDITORA ) VALUES (31, 'MAKTUB', 24, 1);
INSERT INTO LIVRO ( COD_LIVRO, TITULO, VALOR, COD_EDITORA ) VALUES (55, 'BRIDA', 29.5, 1);
INSERT INTO LIVRO ( COD_LIVRO, TITULO, VALOR, COD_EDITORA ) VALUES (63, 'HISTÓRIAS PARA PAIS, FILHOS E NETOS', 35, 2);
INSERT INTO LIVRO ( COD_LIVRO, TITULO, VALOR, COD_EDITORA ) VALUES (14, 'DOM CASMURRO', 10.9, 3);
INSERT INTO LIVRO (COD_LIVRO, TITULO, VALOR, COD_EDITORA) VALUES (13, 'SQL', 10.9, 4);

INSERT INTO ESCREVE VALUES (31, 1);
INSERT INTO ESCREVE VALUES (55, 1);
INSERT INTO ESCREVE VALUES (63, 1);
INSERT INTO ESCREVE VALUES (14, 2);
INSERT INTO ESCREVE VALUES (13, 3);

INSERT INTO AUTOREXPERIENTE
SELECT * 
FROM AUTOR
WHERE NASCIMENTO < '01/01/1900';

-----------------------------------------------------------------------
CREATE VIEW livro_autor
AS SELECT nome, titulo
FROM autor, escreve, livro
WHERE autor.cod_autor = cod_autor_esc AND
cod_livro_esc = cod_livro;

select * from livro_autor;
-----------------------------------------------------------------------
drop view livro_editora;
CREATE VIEW livro_editora (titulo, editora)
AS SELECT titulo, razao
FROM livro, editora
WHERE livro.cod_editora = editora.cod_editora;

select * from livro_editora;
-----------------------------------------------------------------------
CREATE VIEW autor_experiente AS
SELECT *
FROM autor
WHERE nascimento < '01/01/1900';

select * from autor_experiente;
select * from autor;

INSERT INTO autor_experiente VALUES (66,'autor_exemplo','01/01/1870'); 


pg_views

